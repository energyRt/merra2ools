<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Get started with `merra2ools` • merra2ools</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Get started with `merra2ools`">
<meta property="og:description" content="merra2ools">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-00GHMPMM37"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-00GHMPMM37');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">merra2ools</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.03</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/merra2ools.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/merra2.html">MERRA-2 subset</a>
    </li>
    <li>
      <a href="../articles/solarpower.html">Solar Power</a>
    </li>
    <li>
      <a href="../articles/windpower.html">Wind Power</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/energyRt/merra2ools/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="merra2ools_files/kePrint-0.0.1/kePrint.js"></script><link href="merra2ools_files/lightable-0.0.1/lightable.css" rel="stylesheet">
<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Get started with <code>merra2ools</code>
</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/energyRt/merra2ools/blob/HEAD/vignettes/merra2ools.Rmd" class="external-link"><code>vignettes/merra2ools.Rmd</code></a></small>
      <div class="hidden name"><code>merra2ools.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p><strong>merra2ools</strong> is an <a href="https://www.r-project.org/" class="external-link">R</a> library and a dataset. It is
assumed that R version &gt;=4.0 is pre-installed. (<a href="https://cran.r-project.org/bin/windows/Rtools/" class="external-link"><code>Rtools</code></a>
is also required on Windows to build this and several other packages
from source or GitHub). It is also recommended (though it is not
required) to use <a href="https://www.rstudio.com/products/rstudio/download/" class="external-link">RStudio</a> or
other IDE for R. <code>merra2ools</code> depends on several R-packages
which (if not yet available on your system) will be installed along with
the <code>merra2ools</code> installation (see the package <a href="https://github.com/energyRt/merra2ools/blob/master/DESCRIPTION" class="external-link">DESCRIPTION</a>
for details). The package also requires its dataset to be downloaded
separately from the installation of the package (see below). Though
<code>merra2ools</code> package can operate without the dataset (for
estimation capacity factors, solar geometry, etc.), the supplied data
should be formatted in the same way as it is expected by the package
functions.<br>
 <br><strong>merra2sample</strong> is 12-days example of the the
<code>merra2ools</code> subset (41 years), 21st-day of each month of
2010. It can installed directly from GitHub, and used for quick checks
of the data and its format; it is also used to build vignettes
(articles) of <code>merra2ools</code> package. Since the example dataset
has considerable size for R-packages (~0.5Gb) and mostly repeats the
main dataset, it is saved as a separate package.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pkg</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/installed.packages.html" class="external-link">installed.packages</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="co"># returns names of installed packages</span></span>
<span><span class="co"># Installation of `merra2ools` package</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="op">(</span><span class="st">"remotes"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu">pkg</span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"remotes"</span><span class="op">)</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="op">(</span><span class="st">"merra2ools"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu">pkg</span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"energyRt/merra2ools"</span>, dependencies <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="op">(</span><span class="st">"merra2sample"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu">pkg</span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"energyRt/merra2sample"</span><span class="op">)</span></span>
<span><span class="co"># Packages used in the vignette</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="op">(</span><span class="st">"rnaturalearthhires"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu">pkg</span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"ropensci/rnaturalearthhires"</span><span class="op">)</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="op">(</span><span class="st">"scales"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu">pkg</span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"scales"</span><span class="op">)</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="op">(</span><span class="st">"cowplot"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu">pkg</span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"cowplot"</span><span class="op">)</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="op">(</span><span class="st">"kableExtra"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu">pkg</span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"kableExtra"</span><span class="op">)</span></span></code></pre></div>
<p><strong><code>merra2ools</code> dataset</strong> (~270Gb) can be
downloaded from <a href="https://doi.org/10.5061/dryad.v41ns1rtt" class="external-link">https://doi.org/10.5061/dryad.v41ns1rtt</a>,
unziped in a dedicated directory on an internal or external hard-drive,
and configured as described below.</p>
</div>
<div class="section level2">
<h2 id="setting-up">Setting up<a class="anchor" aria-label="anchor" href="#setting-up"></a>
</h2>
<p>Loading packages used in the vignette.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://energyRt.github.io/merra2ools/">merra2ools</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://wilkelab.org/cowplot/" class="external-link">cowplot</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://haozhu233.github.io/kableExtra/" class="external-link">kableExtra</a></span><span class="op">)</span></span></code></pre></div>
<p>Checking if the dataset is connected.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/merra2.html">check_merra2</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; 492 merra2ools data-files found</span></span></code></pre></div>
<p>Connecting the dataset (if not yet connected)</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/merra2.html">check_merra2</a></span><span class="op">(</span><span class="st">"PATH TO THE DOWNLOADED DATA"</span><span class="op">)</span> <span class="co"># check if the data in the directory</span></span>
<span><span class="fu"><a href="../reference/merra2.html">set_merra2_options</a></span><span class="op">(</span>merra2.dir <span class="op">=</span> <span class="st">"PATH TO THE DOWNLOADED DATA"</span><span class="op">)</span> <span class="co"># safe the path</span></span>
<span><span class="fu"><a href="../reference/merra2.html">get_merra2_dir</a></span><span class="op">(</span><span class="op">)</span>  <span class="co"># check if the path is saved</span></span>
<span><span class="fu"><a href="../reference/merra2.html">check_merra2</a></span><span class="op">(</span>detailed <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="accessing-the-data">Accessing the data<a class="anchor" aria-label="anchor" href="#accessing-the-data"></a>
</h2>
<p>The database is organized in monthly files in <code>fst</code>
format. There are two functions to read a whole file
(<code><a href="../reference/read_merra_file.html">read_merra_file()</a></code>) or read a subset for specified
locations and time period (<code><a href="../reference/get_merra2_subset.html">get_merra2_subset()</a></code>). Both
functions provide an option to read the dataset in the scaled format, in
reported units (default) or “raw” format (as integers - the way it is
stored).</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_merra_file.html">read_merra_file</a></span><span class="op">(</span><span class="st">"202012"</span>, as_integers <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<table class="table table" style="font-size: 8px; margin-left: auto; margin-right: auto;">
<caption style="font-size: initial !important;">
Subset of raw data (as integers)
</caption>
<thead><tr>
<th style="text-align:left;">
UTC
</th>
<th style="text-align:right;">
locid
</th>
<th style="text-align:right;">
W10M.e1
</th>
<th style="text-align:right;">
W50M.e1
</th>
<th style="text-align:right;">
WDIR.e_1
</th>
<th style="text-align:right;">
T10M.C
</th>
<th style="text-align:right;">
SWGDN
</th>
<th style="text-align:right;">
ALBEDO.e2
</th>
<th style="text-align:right;">
PRECTOTCORR.kg_m2_h.e1
</th>
<th style="text-align:right;">
RHOA.e2
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;min-width: 11em; background-color: lightgrey !important;">
2020-12-01 00:30:00
</td>
<td style="text-align:right;background-color: lightgrey !important;">
1
</td>
<td style="text-align:right;">
33
</td>
<td style="text-align:right;">
47
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
-35
</td>
<td style="text-align:right;">
421
</td>
<td style="text-align:right;">
80
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
99
</td>
</tr>
<tr>
<td style="text-align:left;min-width: 11em; background-color: lightgrey !important;">
2020-12-01 00:30:00
</td>
<td style="text-align:right;background-color: lightgrey !important;">
2
</td>
<td style="text-align:right;">
33
</td>
<td style="text-align:right;">
47
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
-35
</td>
<td style="text-align:right;">
421
</td>
<td style="text-align:right;">
80
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
99
</td>
</tr>
<tr>
<td style="text-align:left;min-width: 11em; background-color: lightgrey !important;">
2020-12-01 00:30:00
</td>
<td style="text-align:right;background-color: lightgrey !important;">
3
</td>
<td style="text-align:right;">
33
</td>
<td style="text-align:right;">
47
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
-35
</td>
<td style="text-align:right;">
421
</td>
<td style="text-align:right;">
80
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
99
</td>
</tr>
<tr>
<td style="text-align:left;min-width: 11em; background-color: lightgrey !important;">
2020-12-01 00:30:00
</td>
<td style="text-align:right;background-color: lightgrey !important;">
4
</td>
<td style="text-align:right;">
33
</td>
<td style="text-align:right;">
47
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
-35
</td>
<td style="text-align:right;">
421
</td>
<td style="text-align:right;">
80
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
99
</td>
</tr>
<tr>
<td style="text-align:left;min-width: 11em; background-color: lightgrey !important;">
2020-12-01 00:30:00
</td>
<td style="text-align:right;background-color: lightgrey !important;">
5
</td>
<td style="text-align:right;">
33
</td>
<td style="text-align:right;">
47
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
-35
</td>
<td style="text-align:right;">
421
</td>
<td style="text-align:right;">
80
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
99
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_merra2_subset.html">get_merra2_subset</a></span><span class="op">(</span>from <span class="op">=</span> <span class="st">"20201130 01"</span>, to <span class="op">=</span> <span class="st">"20201201 23"</span><span class="op">)</span></span></code></pre></div>
<table class="table table" style="font-size: 8px; margin-left: auto; margin-right: auto;">
<caption style="font-size: initial !important;">
merra2ools subset
</caption>
<thead><tr>
<th style="text-align:left;">
UTC
</th>
<th style="text-align:right;">
locid
</th>
<th style="text-align:right;">
W10M.e1
</th>
<th style="text-align:right;">
W50M.e1
</th>
<th style="text-align:right;">
WDIR.e_1
</th>
<th style="text-align:right;">
T10M.C
</th>
<th style="text-align:right;">
SWGDN
</th>
<th style="text-align:right;">
ALBEDO.e2
</th>
<th style="text-align:right;">
PRECTOTCORR.kg_m2_h.e1
</th>
<th style="text-align:right;">
RHOA.e2
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;min-width: 11em; background-color: lightgrey !important;">
2020-12-01 00:30:00
</td>
<td style="text-align:right;background-color: lightgrey !important;">
1
</td>
<td style="text-align:right;">
33
</td>
<td style="text-align:right;">
47
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
-35
</td>
<td style="text-align:right;">
421
</td>
<td style="text-align:right;">
80
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
99
</td>
</tr>
<tr>
<td style="text-align:left;min-width: 11em; background-color: lightgrey !important;">
2020-12-01 00:30:00
</td>
<td style="text-align:right;background-color: lightgrey !important;">
2
</td>
<td style="text-align:right;">
33
</td>
<td style="text-align:right;">
47
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
-35
</td>
<td style="text-align:right;">
421
</td>
<td style="text-align:right;">
80
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
99
</td>
</tr>
<tr>
<td style="text-align:left;min-width: 11em; background-color: lightgrey !important;">
2020-12-01 00:30:00
</td>
<td style="text-align:right;background-color: lightgrey !important;">
3
</td>
<td style="text-align:right;">
33
</td>
<td style="text-align:right;">
47
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
-35
</td>
<td style="text-align:right;">
421
</td>
<td style="text-align:right;">
80
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
99
</td>
</tr>
<tr>
<td style="text-align:left;min-width: 11em; background-color: lightgrey !important;">
2020-12-01 00:30:00
</td>
<td style="text-align:right;background-color: lightgrey !important;">
4
</td>
<td style="text-align:right;">
33
</td>
<td style="text-align:right;">
47
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
-35
</td>
<td style="text-align:right;">
421
</td>
<td style="text-align:right;">
80
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
99
</td>
</tr>
<tr>
<td style="text-align:left;min-width: 11em; background-color: lightgrey !important;">
2020-12-01 00:30:00
</td>
<td style="text-align:right;background-color: lightgrey !important;">
5
</td>
<td style="text-align:right;">
33
</td>
<td style="text-align:right;">
47
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
-35
</td>
<td style="text-align:right;">
421
</td>
<td style="text-align:right;">
80
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
99
</td>
</tr>
</tbody>
</table>
</div>
<div class="section level2">
<h2 id="locations-identifiers">Locations identifiers<a class="anchor" aria-label="anchor" href="#locations-identifiers"></a>
</h2>
<p>Every data-point in the used MERRA-2 collections (see the dataset
description) is associated with coordinates and time. The original
MERRA-2 files have index-variables <code>V1</code>, <code>V2</code>, and
<code>V3</code> to identify longitude, latitude, and time (hour)
dimensions respectively. For convenience, a location identifier
<code>locid</code> has been generated as a Kronecker product of
<code>V1</code> and <code>V2</code>. The <code>locid</code> identifier
is used as the key variable of MERRA-2 locations, instead of
<code>V1</code> and <code>V2</code>. The time identifier
(<code>V3</code> - hour) is combined with the year, month, and day in
<code>UTC</code> key variable. The total number of location points in
MERRA-2 is 207,936 (576 X 361). The identifier is saved in the
<code>merra2ools</code> package <code>\data</code> directory and can be
called with <code>data</code> function (<code>data("locid")</code>) or
directly <code>locid</code>.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Ways to call `locid` data.frame</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"locid"</span><span class="op">)</span></span>
<span><span class="fu">merra2ools</span><span class="fu">::</span><span class="va">locid</span></span>
<span><span class="va">locid</span></span></code></pre></div>
 <br><table class="table table" style="font-size: 8px; margin-left: auto; margin-right: auto;">
<caption style="font-size: initial !important;">
Location identifiers
</caption>
<thead><tr>
<th style="text-align:right;">
lon
</th>
<th style="text-align:right;">
lat
</th>
<th style="text-align:right;">
locid
</th>
<th style="text-align:right;">
V1
</th>
<th style="text-align:right;">
V2
</th>
<th style="text-align:right;">
FRLAKE
</th>
<th style="text-align:right;">
FRLAND
</th>
<th style="text-align:right;">
FRLANDICE
</th>
<th style="text-align:right;">
FROCEAN
</th>
<th style="text-align:right;">
PHIS
</th>
<th style="text-align:right;">
SGH
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
-180.000
</td>
<td style="text-align:right;">
-90
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
27576.33
</td>
<td style="text-align:right;">
11.49101
</td>
</tr>
<tr>
<td style="text-align:right;">
-179.375
</td>
<td style="text-align:right;">
-90
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
27576.33
</td>
<td style="text-align:right;">
11.49101
</td>
</tr>
<tr>
<td style="text-align:right;">
-178.750
</td>
<td style="text-align:right;">
-90
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
27576.33
</td>
<td style="text-align:right;">
11.49101
</td>
</tr>
<tr>
<td style="text-align:right;">
178.125
</td>
<td style="text-align:right;">
90
</td>
<td style="text-align:right;">
207934
</td>
<td style="text-align:right;">
574
</td>
<td style="text-align:right;">
361
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.9999962
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0.00000
</td>
</tr>
<tr>
<td style="text-align:right;">
178.750
</td>
<td style="text-align:right;">
90
</td>
<td style="text-align:right;">
207935
</td>
<td style="text-align:right;">
575
</td>
<td style="text-align:right;">
361
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.9999962
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0.00000
</td>
</tr>
<tr>
<td style="text-align:right;">
179.375
</td>
<td style="text-align:right;">
90
</td>
<td style="text-align:right;">
207936
</td>
<td style="text-align:right;">
576
</td>
<td style="text-align:right;">
361
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.9999962
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0.00000
</td>
</tr>
</tbody>
</table>
<details><summary>
code
</summary><div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lon</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">locid</span><span class="op">$</span><span class="va">lon</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">lon</span>, <span class="fl">10</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">lon</span><span class="op">)</span></span>
<span></span>
<span><span class="va">lat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">locid</span><span class="op">$</span><span class="va">lat</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">lat</span>, <span class="fl">10</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">lat</span><span class="op">)</span></span>
<span></span>
<span><span class="va">lo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">180</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">lon</span><span class="op">)</span>, by <span class="op">=</span> <span class="fl">30</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">lon</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">la</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">90</span>, <span class="fl">90</span>, by <span class="op">=</span> <span class="fl">15</span><span class="op">)</span></span>
<span></span>
<span><span class="va">locid_sample</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">locid</span>, <span class="va">lon</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">lo</span>, <span class="va">lat</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">la</span><span class="op">)</span></span>
<span><span class="va">world_map</span> <span class="op">&lt;-</span> <span class="fu">rnaturalearth</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/rnaturalearth/reference/ne_countries.html" class="external-link">ne_countries</a></span><span class="op">(</span>scale <span class="op">=</span> <span class="st">"small"</span>, returnclass <span class="op">=</span> <span class="st">"sf"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fig.locid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"wheat"</span>, alpha <span class="op">=</span> <span class="fl">.75</span>, colour <span class="op">=</span> <span class="cn">NA</span>, size <span class="op">=</span> <span class="fl">0.25</span>, data <span class="op">=</span> <span class="va">world_map</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_rect</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>xmin <span class="op">=</span> <span class="va">xmin</span>, xmax <span class="op">=</span> <span class="va">xmax</span>, ymin <span class="op">=</span> <span class="va">ymin</span>, ymax <span class="op">=</span> <span class="va">ymax</span><span class="op">)</span>,</span>
<span>    data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>xmin <span class="op">=</span> <span class="op">-</span><span class="fl">180</span>, xmax <span class="op">=</span> <span class="fl">180</span>, ymin <span class="op">=</span> <span class="op">-</span><span class="fl">90</span>, ymax <span class="op">=</span> <span class="fl">90</span><span class="op">)</span>,</span>
<span>    alpha <span class="op">=</span> <span class="fl">.5</span>, fill <span class="op">=</span> <span class="cn">NA</span>, colour <span class="op">=</span> <span class="st">"grey85"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">lon</span>, y <span class="op">=</span> <span class="va">lat</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">locid_sample</span>, size <span class="op">=</span> <span class="fl">1</span>, colour <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html" class="external-link">geom_text</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">lon</span>, y <span class="op">=</span> <span class="va">lat</span>, label <span class="op">=</span> <span class="va">locid</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">locid_sample</span>, </span>
<span>             position <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_nudge.html" class="external-link">position_nudge</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>,</span>
<span>             alpha <span class="op">=</span> <span class="fl">0.75</span>,</span>
<span>             size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">3</span>, <span class="st">"lines"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">ceiling</a></span><span class="op">(</span><span class="va">lo</span><span class="op">)</span>, minor_breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">ceiling</a></span><span class="op">(</span><span class="va">lo</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">la</span><span class="op">)</span>, minor_breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">ceiling</a></span><span class="op">(</span><span class="va">la</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"lon"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">coord_sf</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">190</span>, <span class="fl">190</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">95</span>, <span class="fl">95</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># labs(x = "lon", title = "Location ID (`locid`) layout of MERRA-2 subset") +</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>        axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>family <span class="op">=</span> <span class="st">'arial'</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html" class="external-link">ggsave</a></span><span class="op">(</span><span class="st">"images/locid_map2.png"</span>, <span class="va">fig.locid</span>, width <span class="op">=</span> <span class="fl">9</span>, height <span class="op">=</span> <span class="fl">5.</span><span class="op">)</span></span></code></pre></div>
</details><div class="figure" style="text-align: center">
<img src="images/locid_map.png" alt="locid_map" width="1350"><p class="caption">
locid_map
</p>
</div>
</div>
<div class="section level2">
<h2 id="matching-locid-with-a-map">Matching <code>locid</code> with a map<a class="anchor" aria-label="anchor" href="#matching-locid-with-a-map"></a>
</h2>
<p>Location identifiers in <code>merra2ools</code> dataset can be seen
as spatial points or centers (centroids) of a spatial grid or spatial
polygons. Subsetting <code>locid</code> for a particular geographical
region can be done using a “map” of the region in
<code>SpatialPolygonsDataFrame</code> format (<code>spdf</code>).
Function <code>get_locid</code> offers two alternative criteria of
selecting <code>locid</code>s is implemented in <code>get_locid</code>
function:<br>
* <code>locid</code> as a spatial points <em>overlay</em> the map’s
spatial polygons (method = “points”);<br>
* <code>locid</code> as a spatial polygon <em>intersect</em> with the
map’s spatial polygons (method = “intersect”).</p>
<p> <br>
Three examples below compare subsetting with the two methods for three
different regions/countries.</p>
<div class="section level3">
<h3 id="example-1--florida-usa">Example 1. Florida, USA<a class="anchor" aria-label="anchor" href="#example-1--florida-usa"></a>
</h3>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># US-map</span></span>
<span><span class="va">usa_sf</span> <span class="op">&lt;-</span> <span class="fu">rnaturalearth</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/rnaturalearth/reference/ne_states.html" class="external-link">ne_states</a></span><span class="op">(</span>iso_a2 <span class="op">=</span> <span class="st">"us"</span>, returnclass <span class="op">=</span> <span class="st">"sf"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Subset Florida map</span></span>
<span><span class="va">florida_sf</span> <span class="op">&lt;-</span> <span class="va">usa_sf</span><span class="op">[</span><span class="va">usa_sf</span><span class="op">$</span><span class="va">name_en</span> <span class="op">==</span> <span class="st">"Florida"</span>,<span class="op">]</span></span>
<span></span>
<span><span class="co"># location IDs, two methods</span></span>
<span><span class="va">locid_fl_p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_locid.html">get_locid</a></span><span class="op">(</span><span class="va">florida_sf</span>, method <span class="op">=</span> <span class="st">"points"</span><span class="op">)</span></span>
<span><span class="va">locid_fl_i</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_locid.html">get_locid</a></span><span class="op">(</span><span class="va">florida_sf</span>, method <span class="op">=</span> <span class="st">"polygons"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># MERRA-2 grid for the selected `locid's`</span></span>
<span><span class="va">locid_fl_grid</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_merra2_grid.html">get_merra2_grid</a></span><span class="op">(</span><span class="st">"poly"</span>, locid <span class="op">=</span> <span class="va">locid_fl_i</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot</span></span>
<span><span class="va">a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">florida_sf</span>, fill <span class="op">=</span> <span class="st">"wheat"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">locid_fl_grid</span>, color <span class="op">=</span> <span class="st">"darkgrey"</span>, fill <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">lon</span>, <span class="va">lat</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">locid</span><span class="op">[</span><span class="va">locid_fl_p</span>,<span class="op">]</span>, color <span class="op">=</span> <span class="st">"red"</span>, shape <span class="op">=</span> <span class="fl">16</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">lon</span>, <span class="va">lat</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">locid</span><span class="op">[</span><span class="va">locid_fl_i</span>,<span class="op">]</span>, color <span class="op">=</span> <span class="st">"red"</span>, shape <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">""</span>, y <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html" class="external-link">ggsave</a></span><span class="op">(</span><span class="st">"images/example1_florida_locids.png"</span>, <span class="va">a</span>, width <span class="op">=</span> <span class="fl">5</span>, height <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="images/example1_florida_locids.png" alt="MERRA-2 locations for Florida" width="750"><p class="caption">
MERRA-2 locations for Florida
</p>
</div>
</div>
<div class="section level3">
<h3 id="example-2--iceland">Example 2. Iceland<a class="anchor" aria-label="anchor" href="#example-2--iceland"></a>
</h3>
<details><summary>
code
</summary><div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Map</span></span>
<span><span class="va">iceland_sf</span> <span class="op">&lt;-</span> <span class="fu">rnaturalearth</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/rnaturalearth/reference/ne_countries.html" class="external-link">ne_countries</a></span><span class="op">(</span>country <span class="op">=</span> <span class="st">"iceland"</span>, scale <span class="op">=</span> <span class="st">"large"</span>,</span>
<span>                                          returnclass <span class="op">=</span> <span class="st">"sf"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># location IDs, two methods</span></span>
<span><span class="va">locid_isl_p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_locid.html">get_locid</a></span><span class="op">(</span><span class="va">iceland_sf</span>, method <span class="op">=</span> <span class="st">"points"</span><span class="op">)</span></span>
<span><span class="va">locid_isl_i</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_locid.html">get_locid</a></span><span class="op">(</span><span class="va">iceland_sf</span>, method <span class="op">=</span> <span class="st">"poly"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># MERRA-2 grid for the selected `locid's`</span></span>
<span><span class="va">locid_isl_grid</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_merra2_grid.html">get_merra2_grid</a></span><span class="op">(</span><span class="st">"poly"</span>, locid <span class="op">=</span> <span class="va">locid_isl_i</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plots</span></span>
<span><span class="va">a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">iceland_sf</span>, fill <span class="op">=</span> <span class="st">"wheat"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">locid_isl_grid</span>, color <span class="op">=</span> <span class="st">"darkgrey"</span>, fill <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">lon</span>, <span class="va">lat</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">locid</span><span class="op">[</span><span class="va">locid_isl_p</span>,<span class="op">]</span>, color <span class="op">=</span> <span class="st">"red"</span>, shape <span class="op">=</span> <span class="fl">16</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">lon</span>, <span class="va">lat</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">locid</span><span class="op">[</span><span class="va">locid_isl_i</span>,<span class="op">]</span>, color <span class="op">=</span> <span class="st">"red"</span>, shape <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">""</span>, y <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html" class="external-link">ggsave</a></span><span class="op">(</span><span class="st">"images/example2_iceland_locids.png"</span>, <span class="va">a</span>, width <span class="op">=</span> <span class="fl">5</span>, height <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></code></pre></div>
</details><div class="figure" style="text-align: center">
<img src="images/example2_iceland_locids.png" alt="MERRA-2 locations for Iceland" width="750"><p class="caption">
MERRA-2 locations for Iceland
</p>
</div>
</div>
<div class="section level3">
<h3 id="example-3--kenya">Example 3. Kenya<a class="anchor" aria-label="anchor" href="#example-3--kenya"></a>
</h3>
<details><summary>
code
</summary><div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Map</span></span>
<span><span class="va">kenya_sf</span> <span class="op">&lt;-</span> <span class="fu">rnaturalearth</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/rnaturalearth/reference/ne_countries.html" class="external-link">ne_countries</a></span><span class="op">(</span>country <span class="op">=</span> <span class="st">"kenya"</span>, returnclass <span class="op">=</span> <span class="st">"sf"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># location IDs, two methods</span></span>
<span><span class="va">locid_ken_p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_locid.html">get_locid</a></span><span class="op">(</span><span class="va">kenya_sf</span>, method <span class="op">=</span> <span class="st">"points"</span><span class="op">)</span></span>
<span><span class="va">locid_ken_i</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_locid.html">get_locid</a></span><span class="op">(</span><span class="va">kenya_sf</span>, method <span class="op">=</span> <span class="st">"poly"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># MERRA-2 grid for the selected `locid's`</span></span>
<span><span class="va">locid_ken_grid</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_merra2_grid.html">get_merra2_grid</a></span><span class="op">(</span><span class="st">"poly"</span>, locid <span class="op">=</span> <span class="va">locid_ken_i</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot</span></span>
<span><span class="va">a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">kenya_sf</span>, fill <span class="op">=</span> <span class="st">"wheat"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">locid_ken_grid</span>, color <span class="op">=</span> <span class="st">"darkgrey"</span>, fill <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">lon</span>, <span class="va">lat</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">locid</span><span class="op">[</span><span class="va">locid_ken_p</span>,<span class="op">]</span>, color <span class="op">=</span> <span class="st">"red"</span>, shape <span class="op">=</span> <span class="fl">16</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">lon</span>, <span class="va">lat</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">locid</span><span class="op">[</span><span class="va">locid_ken_i</span>,<span class="op">]</span>, color <span class="op">=</span> <span class="st">"red"</span>, shape <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">""</span>, y <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html" class="external-link">ggsave</a></span><span class="op">(</span><span class="st">"images/example3_kenya_locids.png"</span>, <span class="va">a</span>, width <span class="op">=</span> <span class="fl">5</span>, height <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></code></pre></div>
</details><div class="figure" style="text-align: center">
<img src="images/example3_kenya_locids.png" alt="MERRA-2 locations for Kenya" width="750"><p class="caption">
MERRA-2 locations for Kenya
</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="get-merra-2-subset">Get MERRA-2 subset<a class="anchor" aria-label="anchor" href="#get-merra-2-subset"></a>
</h2>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">merra_fl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_merra2_subset.html">get_merra2_subset</a></span><span class="op">(</span>locid <span class="op">=</span> <span class="va">locid_fl_i</span>, </span>
<span>                              from <span class="op">=</span> <span class="st">"20190101 00"</span>, to <span class="op">=</span> <span class="st">"20191231 23"</span>, </span>
<span>                              tz <span class="op">=</span> <span class="st">"US/Eastern"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">merra_isl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_merra2_subset.html">get_merra2_subset</a></span><span class="op">(</span>locid <span class="op">=</span> <span class="va">locid_isl_i</span>, </span>
<span>                               from <span class="op">=</span> <span class="st">"20190101 00"</span>, to <span class="op">=</span> <span class="st">"20191231 23"</span>, </span>
<span>                               tz <span class="op">=</span> <span class="st">"Atlantic/Reykjavik"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">merra_ken</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_merra2_subset.html">get_merra2_subset</a></span><span class="op">(</span>locid <span class="op">=</span> <span class="va">locid_ken_i</span>, </span>
<span>                               from <span class="op">=</span> <span class="st">"20190101 00"</span>, to <span class="op">=</span> <span class="st">"20191231 23"</span>, </span>
<span>                               tz <span class="op">=</span> <span class="st">"Africa/Nairobi"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="wind-power">Wind power<a class="anchor" aria-label="anchor" href="#wind-power"></a>
</h2>
<p>Estimation of wind power capacity factors (CF) for the first example
- <em>Florida</em>.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Estimate capacity factors</span></span>
<span><span class="va">merra_fl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fWindCF.html">fWindCF</a></span><span class="op">(</span><span class="va">merra_fl</span>, height <span class="op">=</span> <span class="fl">150</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Annual averages</span></span>
<span><span class="va">win_fl_y</span> <span class="op">&lt;-</span> <span class="va">merra_fl</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="co"># annual averages</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">locid</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>win150af <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">win150af</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_merra2_grid.html">add_merra2_grid</a></span><span class="op">(</span><span class="op">)</span> </span></code></pre></div>
<div class="section level3">
<h3 id="cluster-locations">Cluster locations<a class="anchor" aria-label="anchor" href="#cluster-locations"></a>
</h3>
<p>We can also cluster locations based on correlation of certain
timeseries across locations.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Cluster locations based on correlation</span></span>
<span><span class="va">win_fl_cl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cluster_locid.html">cluster_locid</a></span><span class="op">(</span></span>
<span>  <span class="va">merra_fl</span>, </span>
<span>  varname <span class="op">=</span> <span class="st">"win150af"</span>,</span>
<span>  locid_info <span class="op">=</span> <span class="va">locid_fl_grid</span>, </span>
<span>  max_loss <span class="op">=</span> <span class="fl">.05</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">tol_level</span> <span class="op">&lt;-</span> <span class="fl">.10</span> <span class="co"># 10%</span></span>
<span><span class="co"># tol_level &lt;- .05 # 5%</span></span>
<span></span>
<span><span class="co"># Select clusters with {tol_level}% tolerance (loss of standard deviation) </span></span>
<span><span class="va">win_fl_cl_k</span> <span class="op">&lt;-</span> <span class="va">win_fl_cl</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">sd_loss</span> <span class="op">&lt;=</span> <span class="va">tol_level</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>k_min <span class="op">=</span> <span class="op">(</span><span class="va">k</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">k</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">k_min</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">k_min</span><span class="op">)</span> </span></code></pre></div>
<details><summary>
code
</summary><div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Cluster-loss figure</span></span>
<span><span class="va">win_fl_cl_kk</span> <span class="op">&lt;-</span> <span class="va">win_fl_cl</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">k</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>sd_loss <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">sd_loss</span><span class="op">)</span>, N <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">N</span><span class="op">)</span>, .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">locid_win_cl_k_i</span> <span class="op">&lt;-</span> <span class="va">win_fl_cl_k</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">k</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>sd_loss <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">sd_loss</span><span class="op">)</span>, N <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">N</span><span class="op">)</span>, .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">win_fl_cl_kk</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">k</span>, <span class="va">sd_loss</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"dodgerblue"</span>, linewidth <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">k</span>, <span class="va">sd_loss</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"red"</span>, data <span class="op">=</span> <span class="va">locid_win_cl_k_i</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="va">tol_level</span>, color <span class="op">=</span> <span class="st">"red"</span>, linetype <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="va"><a href="https://scales.r-lib.org/reference/percent_format.html" class="external-link">percent</a></span>, limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># scale_x_continuous(breaks = rev_integer_breaks(5)) +</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Number of clusters (k)"</span>, y <span class="op">=</span> <span class="st">"loss, % of s.d."</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html" class="external-link">ggsave</a></span><span class="op">(</span><span class="st">"images/example1_florida_wind_clusters.png"</span>, <span class="va">a</span>, width <span class="op">=</span> <span class="fl">4.5</span>, </span>
<span>       height <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
</details><div class="figure" style="text-align: center">
<img src="images/example1_florida_wind_clusters.png" alt="Loss of information as a function of number of clusters" width="675"><p class="caption">
Loss of information as a function of number of clusters
</p>
</div>
<details><summary>
code
</summary><div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">win_fl_cl_sf</span> <span class="op">&lt;-</span> <span class="va">locid_fl_grid</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/valid.html" class="external-link">st_make_valid</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">win_fl_cl_k</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html" class="external-link">any_of</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"locid"</span>, <span class="st">"cluster"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">cluster</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>cluster <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">cluster</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">win_fl_cl_sf</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"lightgrey"</span>, data <span class="op">=</span> <span class="va">florida_sf</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">cluster</span><span class="op">)</span>, color <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>color <span class="op">=</span> <span class="fu"><a href="https://scales.r-lib.org/reference/alpha.html" class="external-link">alpha</a></span><span class="op">(</span><span class="st">"black"</span>, <span class="fl">1</span><span class="op">)</span>, fill <span class="op">=</span> <span class="cn">NA</span>, data <span class="op">=</span> <span class="va">florida_sf</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_fill_viridis_d</a></span><span class="op">(</span>option <span class="op">=</span> <span class="st">"H"</span>, direction <span class="op">=</span> <span class="fl">1</span>, name <span class="op">=</span> <span class="st">"Cluster"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Clustered wind sites by region"</span>,</span>
<span>                      <span class="st">", sd_loss &lt;= "</span>, <span class="va">tol_level</span> <span class="op">*</span> <span class="fl">100</span>, <span class="st">"%"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">a</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html" class="external-link">ggsave</a></span><span class="op">(</span><span class="st">"images/example1_florida_wind_clusters_map.png"</span>, <span class="va">a</span>, </span>
<span>       width <span class="op">=</span> <span class="fl">5</span>, height <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></code></pre></div>
</details>
Based on the clustering of the hourly time series, combining 73 wind
capacity factors into 7 clusters will result in loss of standard
deviation less than 10%.
<div class="figure" style="text-align: center">
<img src="images/example1_florida_wind_clusters_map.png" alt="Clustered location based on correlation of wind capacity factors" width="750"><p class="caption">
Clustered location based on correlation of wind capacity factors
</p>
</div>
Do the same for other examples - Iceland and Kenya.<br><details><summary>
code
</summary><p><strong>Iceland</strong></p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Estimate capacity factors</span></span>
<span><span class="va">merra_isl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fWindCF.html">fWindCF</a></span><span class="op">(</span><span class="va">merra_isl</span>, height <span class="op">=</span> <span class="fl">150</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Annual averages</span></span>
<span><span class="va">win_isl_y</span> <span class="op">&lt;-</span> <span class="va">merra_isl</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="co"># annual averages</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">locid</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>win150af <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">win150af</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_merra2_grid.html">add_merra2_grid</a></span><span class="op">(</span><span class="op">)</span> </span></code></pre></div>
<p><strong>Kenya</strong></p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Estimate capacity factors</span></span>
<span><span class="va">merra_ken</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fWindCF.html">fWindCF</a></span><span class="op">(</span><span class="va">merra_ken</span>, height <span class="op">=</span> <span class="fl">150</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Annual averages</span></span>
<span><span class="va">win_ken_y</span> <span class="op">&lt;-</span> <span class="va">merra_ken</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">locid</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>win150af <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">win150af</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_merra2_grid.html">add_merra2_grid</a></span><span class="op">(</span><span class="op">)</span> </span></code></pre></div>
</details>
</div>
</div>
<div class="section level2">
<h2 id="solar-power">Solar power<a class="anchor" aria-label="anchor" href="#solar-power"></a>
</h2>
<p>Estimation of Plane of Array Irradiance (POA) for fixed tilted (fl)
array-systems for <em>Florida</em></p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Estimate POA</span></span>
<span><span class="va">merra_fl</span> <span class="op">&lt;-</span> <span class="va">merra_fl</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/poa_irradiance.html">fPOA</a></span><span class="op">(</span>array.type <span class="op">=</span> <span class="st">"fl"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Annual averages</span></span>
<span><span class="va">poa_fl_y</span> <span class="op">&lt;-</span> <span class="va">merra_fl</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">locid</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>POA.fl <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">POA.fl</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">/</span><span class="fl">365</span><span class="op">/</span><span class="fl">1e3</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_merra2_grid.html">add_merra2_grid</a></span><span class="op">(</span><span class="op">)</span> </span></code></pre></div>
Repeat for other examples.<br><details><summary>
code
</summary><p><strong>Iceland</strong></p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Estimate POA</span></span>
<span><span class="va">merra_isl</span> <span class="op">&lt;-</span> <span class="va">merra_isl</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/poa_irradiance.html">fPOA</a></span><span class="op">(</span>array.type <span class="op">=</span> <span class="st">"fl"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Annual averages</span></span>
<span><span class="va">poa_isl_y</span> <span class="op">&lt;-</span> <span class="va">merra_isl</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">locid</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>POA.fl <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">POA.fl</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">/</span><span class="fl">365</span><span class="op">/</span><span class="fl">1e3</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_merra2_grid.html">add_merra2_grid</a></span><span class="op">(</span><span class="op">)</span> </span></code></pre></div>
<p><strong>Kenya</strong></p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Estimate POA</span></span>
<span><span class="va">merra_ken</span> <span class="op">&lt;-</span> <span class="va">merra_ken</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/poa_irradiance.html">fPOA</a></span><span class="op">(</span>array.type <span class="op">=</span> <span class="st">"fl"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Annual averages</span></span>
<span><span class="va">poa_ken_y</span> <span class="op">&lt;-</span> <span class="va">merra_ken</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">locid</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>POA.fl <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">POA.fl</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">/</span><span class="fl">365</span><span class="op">/</span><span class="fl">1e3</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_merra2_grid.html">add_merra2_grid</a></span><span class="op">(</span><span class="op">)</span> </span></code></pre></div>
<p><strong>Comparative figure</strong><br>
To use the same scale,</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wnd_range</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">win_fl_y</span><span class="op">$</span><span class="va">win150af</span>, <span class="va">win_isl_y</span><span class="op">$</span><span class="va">win150af</span>, <span class="va">win_ken_y</span><span class="op">$</span><span class="va">win150af</span><span class="op">)</span></span>
<span><span class="va">wnd_breaks</span> <span class="op">&lt;-</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/breaks_pretty.html" class="external-link">breaks_pretty</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span><span class="op">(</span><span class="va">wnd_range</span><span class="op">)</span></span>
<span><span class="va">wnd_range</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">wnd_breaks</span><span class="op">)</span></span>
<span></span>
<span><span class="va">poa_range</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">poa_fl_y</span><span class="op">$</span><span class="va">POA.fl</span>, <span class="va">poa_isl_y</span><span class="op">$</span><span class="va">POA.fl</span>, <span class="va">poa_ken_y</span><span class="op">$</span><span class="va">POA.fl</span><span class="op">)</span></span>
<span><span class="va">poa_breaks</span> <span class="op">&lt;-</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/breaks_pretty.html" class="external-link">breaks_pretty</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span><span class="op">(</span><span class="va">poa_range</span><span class="op">)</span></span>
<span><span class="va">poa_range</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">poa_breaks</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plot capacity factor variable on map</span></span>
<span><span class="va">cf_plot</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span></span>
<span>  <span class="va">data</span>, <span class="va">gis_sf</span>, <span class="va">var_name</span>, <span class="va">brakes</span>, </span>
<span>  <span class="va">labels</span> <span class="op">=</span> <span class="va">brakes</span>, <span class="va">limits</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">brakes</span><span class="op">)</span>, <span class="va">legend_name</span> <span class="op">=</span> <span class="va">var_name</span>,</span>
<span>  <span class="va">viridis_palette</span> <span class="op">=</span> <span class="st">"viridis"</span>, <span class="va">border_colour</span> <span class="op">=</span> <span class="fu"><a href="https://scales.r-lib.org/reference/alpha.html" class="external-link">alpha</a></span><span class="op">(</span><span class="st">"white"</span>, <span class="fl">.5</span><span class="op">)</span>,</span>
<span>  <span class="va">legend_position</span> <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">.data</span><span class="op">[[</span><span class="va">var_name</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">data</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">gis_sf</span>, fill <span class="op">=</span> <span class="cn">NA</span>, colour <span class="op">=</span> <span class="va">border_colour</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_fill_viridis_c</a></span><span class="op">(</span></span>
<span>    breaks <span class="op">=</span> <span class="va">brakes</span>, labels <span class="op">=</span> <span class="va">labels</span>, limits <span class="op">=</span> <span class="va">limits</span>, name <span class="op">=</span> <span class="va">legend_name</span>,</span>
<span>    option <span class="op">=</span> <span class="va">viridis_palette</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="va">legend_position</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>plot.margin <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">margin</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">0.0</span>, <span class="fl">0.0</span>, <span class="fl">0.0</span>, <span class="st">"cm"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">""</span>, y <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Combine plots into one</span></span>
<span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html" class="external-link">plot_grid</a></span><span class="op">(</span></span>
<span>  <span class="fu">cf_plot</span><span class="op">(</span><span class="va">win_fl_y</span>, <span class="va">florida_sf</span>, <span class="st">"win150af"</span>, <span class="va">wnd_breaks</span><span class="op">)</span>,</span>
<span>  <span class="fu">cf_plot</span><span class="op">(</span><span class="va">win_isl_y</span>, <span class="va">iceland_sf</span>, <span class="st">"win150af"</span>, <span class="va">wnd_breaks</span><span class="op">)</span>,</span>
<span>  <span class="fu">cf_plot</span><span class="op">(</span><span class="va">win_ken_y</span>, <span class="va">kenya_sf</span>, <span class="st">"win150af"</span>, <span class="va">wnd_breaks</span>,</span>
<span>          legend_position <span class="op">=</span> <span class="st">"right"</span>, legend_name <span class="op">=</span> <span class="st">"Wind\nCF"</span><span class="op">)</span>,</span>
<span>  <span class="co"># NULL, NULL, NULL,  </span></span>
<span>  <span class="fu">cf_plot</span><span class="op">(</span><span class="va">poa_fl_y</span>, <span class="va">florida_sf</span>, <span class="st">"POA.fl"</span>, <span class="va">poa_breaks</span>, viridis_palette <span class="op">=</span> <span class="st">"plasma"</span><span class="op">)</span>,</span>
<span>  <span class="fu">cf_plot</span><span class="op">(</span><span class="va">poa_isl_y</span>, <span class="va">iceland_sf</span>, <span class="st">"POA.fl"</span>, <span class="va">poa_breaks</span>, viridis_palette <span class="op">=</span> <span class="st">"plasma"</span><span class="op">)</span>,</span>
<span>  <span class="fu">cf_plot</span><span class="op">(</span><span class="va">poa_ken_y</span>, <span class="va">kenya_sf</span>, <span class="st">"POA.fl"</span>, <span class="va">poa_breaks</span>, viridis_palette <span class="op">=</span> <span class="st">"plasma"</span>,</span>
<span>          legend_position <span class="op">=</span> <span class="st">"right"</span>, legend_name <span class="op">=</span> <span class="st">"POA\nkW/day"</span><span class="op">)</span>,</span>
<span>  <span class="co"># rel_heights = c(1, -.3, 1),</span></span>
<span>  ncol <span class="op">=</span> <span class="fl">3</span>, rel_widths <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1.3</span>, <span class="fl">1.17</span><span class="op">)</span>,</span>
<span>  labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Florida"</span>, <span class="st">"Iceland"</span>, <span class="st">"Kenya"</span><span class="op">)</span>, hjust <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1.6</span>, <span class="op">-</span><span class="fl">1.9</span>, <span class="op">-</span><span class="fl">1.6</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/ggsave2.html" class="external-link">ggsave2</a></span><span class="op">(</span><span class="st">"images/cf_group.png"</span>, width <span class="op">=</span> <span class="fl">8</span>, height <span class="op">=</span> <span class="fl">5</span>, dpi <span class="op">=</span> <span class="fl">200</span><span class="op">)</span></span></code></pre></div>
</details><div class="figure" style="text-align: center">
<img src="images/cf_group.png" alt="Wind power capacity factors (CF) and Solar irradiance on Plane of Array (POA) by regions" width="800"><p class="caption">
Wind power capacity factors (CF) and Solar irradiance on Plane of Array
(POA) by regions
</p>
</div>
</div>
<div class="section level2">
<h2 id="precipitation-by-months">Precipitation by months<a class="anchor" aria-label="anchor" href="#precipitation-by-months"></a>
</h2>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prec_ken_m</span> <span class="op">&lt;-</span> <span class="va">merra_ken</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    local_time <span class="op">=</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/with_tz.html" class="external-link">with_tz</a></span><span class="op">(</span><span class="va">UTC</span>, <span class="st">"Africa/Nairobi"</span><span class="op">)</span>,</span>
<span>    year <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/year.html" class="external-link">year</a></span><span class="op">(</span><span class="va">local_time</span><span class="op">)</span>,</span>
<span>    month <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/month.html" class="external-link">month</a></span><span class="op">(</span><span class="va">local_time</span><span class="op">)</span>,</span>
<span>    month_name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">month.name</span><span class="op">[</span><span class="va">month</span><span class="op">]</span>, levels <span class="op">=</span> <span class="va">month.name</span>, ordered <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">locid</span>, <span class="va">year</span>, <span class="va">month</span>, <span class="va">month_name</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span></span>
<span>    PRECTOTCORR <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">PRECTOTCORR</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>,</span>
<span>    T10M <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">T10M</span><span class="op">)</span>,</span>
<span>    .groups <span class="op">=</span> <span class="st">"drop"</span></span>
<span>    <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_merra2_grid.html">add_merra2_grid</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<details><summary>
code
</summary><div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pre_range</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">prec_ken_m</span><span class="op">$</span><span class="va">PRECTOTCORR</span><span class="op">)</span></span>
<span><span class="va">pre_breaks</span> <span class="op">&lt;-</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/breaks_pretty.html" class="external-link">breaks_pretty</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span><span class="op">(</span><span class="va">pre_range</span><span class="op">)</span></span>
<span><span class="va">pre_range</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">pre_breaks</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">cf_plot</span><span class="op">(</span><span class="va">prec_ken_m</span>, <span class="va">kenya_sf</span>, <span class="st">"PRECTOTCORR"</span>, brakes <span class="op">=</span> <span class="va">pre_breaks</span>, legend_position <span class="op">=</span> <span class="st">"right"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="va">.</span><span class="op">~</span><span class="va">month</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">prec_ken_m</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">PRECTOTCORR</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_fill_distiller</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"YlGnBu"</span>, direction <span class="op">=</span> <span class="fl">1</span>, name <span class="op">=</span> <span class="st">"mm /\nmonth"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="va">.</span><span class="op">~</span><span class="va">month_name</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">kenya_sf</span>, fill <span class="op">=</span> <span class="cn">NA</span>, colour <span class="op">=</span> <span class="fu"><a href="https://scales.r-lib.org/reference/alpha.html" class="external-link">alpha</a></span><span class="op">(</span><span class="st">"black"</span>, <span class="fl">.5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">""</span>, y <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html" class="external-link">ggsave</a></span><span class="op">(</span><span class="st">"images/precipitation_m_kenya.png"</span>, scale <span class="op">=</span> <span class="fl">1.5</span>, width <span class="op">=</span> <span class="fl">5</span>, height <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">prec_ken_m</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">T10M</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_fill_distiller</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Spectral"</span>, direction <span class="op">=</span> <span class="op">-</span><span class="fl">1</span>, name <span class="op">=</span> <span class="st">"\u00B0C"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="va">.</span><span class="op">~</span><span class="va">month_name</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">kenya_sf</span>, fill <span class="op">=</span> <span class="cn">NA</span>, colour <span class="op">=</span> <span class="fu"><a href="https://scales.r-lib.org/reference/alpha.html" class="external-link">alpha</a></span><span class="op">(</span><span class="st">"black"</span>, <span class="fl">.5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html" class="external-link">ggsave</a></span><span class="op">(</span><span class="st">"images/temperature_m_kenya.png"</span>, scale <span class="op">=</span> <span class="fl">1.5</span>, width <span class="op">=</span> <span class="fl">5</span>, height <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></code></pre></div>
</details><div class="figure" style="text-align: center">
<img src="images/precipitation_m_kenya.png" alt="Precipitation by month in Kenya (2019), millimeters / hour (kg/m^2/hour)" width="1125"><p class="caption">
Precipitation by month in Kenya (2019), millimeters / hour (kg/m^2/hour)
</p>
</div>
</div>
<div class="section level2">
<h2 id="air-temperature-by-months">Air temperature by months<a class="anchor" aria-label="anchor" href="#air-temperature-by-months"></a>
</h2>
<div class="figure" style="text-align: center">
<img src="images/temperature_m_kenya.png" alt="Average monthly temperature in Kenya (2019), °C)" width="750"><p class="caption">
Average monthly temperature in Kenya (2019), °C)
</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Oleg Lugovoy, Shuo Gao.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
